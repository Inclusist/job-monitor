{% extends "base.html" %}

{% block title %}Upload CV - Job Monitor{% endblock %}

{% block content %}
<div class="card">
    <h2>Upload Your CV</h2>
    <p>Upload your CV in PDF, DOCX, or TXT format. Our AI will extract your skills, experience, and qualifications.</p>

    <form method="POST" enctype="multipart/form-data" style="margin-top: 2rem;">
        <div class="form-group">
            <label for="email">Your Email</label>
            <input type="email" id="email" name="email" value="{{ email }}" required>
        </div>

        <div class="form-group">
            <label for="cv_file">CV File (PDF, DOCX, TXT - Max 10MB)</label>
            <div class="upload-area" id="uploadArea">
                <input type="file" id="cv_file" name="cv_file" accept=".pdf,.docx,.txt" required style="display: none;">
                <div class="upload-placeholder">
                    <p style="font-size: 3rem; margin-bottom: 1rem;">ðŸ“„</p>
                    <p><strong>Click to upload</strong> or drag and drop</p>
                    <p style="font-size: 0.875rem; color: #666; margin-top: 0.5rem;">PDF, DOCX or TXT (max 10MB)</p>
                </div>
                <div class="upload-filename" style="display: none;"></div>
            </div>
        </div>

        <div class="form-group">
            <label>
                <input type="checkbox" name="set_primary" checked>
                Set as primary CV (used for job matching)
            </label>
        </div>

        <div style="margin-top: 1rem;">
            <button type="submit" class="btn">Upload & Analyze (~$0.02)</button>
            <a href="{{ url_for('index') }}" class="btn btn-secondary" style="margin-left: 1rem;">Cancel</a>
        </div>
    </form>
</div>

<div class="card">
    <h3>What happens when you upload?</h3>
    <ol style="margin-left: 1.5rem; margin-top: 1rem;">
        <li>Your CV is saved securely</li>
        <li>Text is extracted from the document</li>
        <li>Claude AI analyzes and extracts:
            <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                <li>Technical and soft skills</li>
                <li>Work experience and achievements</li>
                <li>Education and certifications</li>
                <li>Languages with proficiency levels</li>
                <li>Career highlights</li>
            </ul>
        </li>
        <li>Structured profile is saved for job matching</li>
    </ol>
    <p style="margin-top: 1rem; color: #666;"><strong>Cost:</strong> ~$0.02 per CV (one-time, using Claude AI)</p>
</div>

<style>
    .upload-area {
        border: 3px dashed #667eea;
        border-radius: 12px;
        padding: 3rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        background: #f8f9ff;
    }

    .upload-area:hover {
        border-color: #764ba2;
        background: #f0f2ff;
    }

    .upload-area.drag-over {
        border-color: #764ba2;
        background: #e8ebff;
        transform: scale(1.02);
    }

    .upload-filename {
        color: #667eea;
        font-weight: 500;
        padding: 1rem;
        background: white;
        border-radius: 8px;
    }
</style>

<script>
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('cv_file');
    const placeholder = uploadArea.querySelector('.upload-placeholder');
    const filenameDiv = uploadArea.querySelector('.upload-filename');

    // Click to upload
    uploadArea.addEventListener('click', () => fileInput.click());

    // File selected
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            const file = e.target.files[0];
            placeholder.style.display = 'none';
            filenameDiv.style.display = 'block';
            filenameDiv.innerHTML = `<p style="font-size: 2rem; margin-bottom: 0.5rem;">âœ“</p><p><strong>${file.name}</strong></p><p style="font-size: 0.875rem; color: #666; margin-top: 0.5rem;">${(file.size / 1024 / 1024).toFixed(2)} MB</p>`;
        }
    });

    // Drag and drop
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('drag-over');
    });

    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('drag-over');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('drag-over');

        if (e.dataTransfer.files.length > 0) {
            fileInput.files = e.dataTransfer.files;
            fileInput.dispatchEvent(new Event('change'));
        }
    });
</script>
{% endblock %}
