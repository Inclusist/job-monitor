{% extends "base.html" %}

{% block title %}Application Dashboard - Job Monitor{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h2>ğŸ“‹ Application Dashboard</h2>
            <p>Jobs you're planning to apply for</p>
        </div>
        <div>
            <a href="{{ url_for('jobs') }}" class="btn">ğŸ” Browse Jobs</a>
        </div>
    </div>
</div>

{% if learning_summary %}
<div class="alert" style="background: #e7f3ff; border-left: 4px solid #007bff;">
    <strong>ğŸ§  Learning Progress:</strong> {{ learning_summary }}
</div>
{% endif %}

{% if not jobs %}
<div class="alert alert-info">
    <strong>No jobs shortlisted yet.</strong>
    <p style="margin-top: 0.5rem;">Browse the <a href="{{ url_for('jobs') }}" style="text-decoration: underline;">jobs
            page</a> and click "â­ Add to Dashboard" on jobs you want to apply for.</p>
</div>
{% else %}

<div class="card">
    <p><strong>{{ jobs|length }}</strong> job{{ 's' if jobs|length != 1 else '' }} in your application pipeline</p>
</div>

{% for job in jobs %}
<div class="card"
    style="border-left: 4px solid {% if (job.match_score or 0) >= 85 %}#28a745{% elif (job.match_score or 0) >= 70 %}#ffc107{% else %}#6c757d{% endif %};">
    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
        <div style="flex: 1;">
            <h3 style="margin: 0; margin-bottom: 0.5rem;">{{ job.title }}</h3>
            <p style="color: #666; margin: 0; font-size: 1.1rem;">{{ job.company }}</p>
        </div>
        <div style="text-align: right; min-width: 100px;">
            <div
                style="font-size: 2rem; font-weight: bold; color: {% if (job.match_score or 0) >= 85 %}#155724{% elif (job.match_score or 0) >= 70 %}#856404{% else %}#721c24{% endif %};">
                {{ job.match_score }}
            </div>
            <span class="badge badge-{{ job.priority }}" style="font-size: 0.75rem;">{{ job.priority }}</span>
        </div>
    </div>

    <div
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
        <div>
            <p style="color: #666; font-size: 0.875rem; margin: 0;">ğŸ“ Location</p>
            <p style="font-weight: 500; margin: 0.25rem 0 0 0;">{{ job.location }}</p>
        </div>
        <div>
            <p style="color: #666; font-size: 0.875rem; margin: 0;">ğŸ“… Posted</p>
            <p style="font-weight: 500; margin: 0.25rem 0 0 0;">{{ job.posted_date.strftime('%Y-%m-%d') if
                job.posted_date else 'Unknown' }}</p>
        </div>
        {% if job.salary %}
        <div>
            <p style="color: #666; font-size: 0.875rem; margin: 0;">ğŸ’° Salary</p>
            <p style="font-weight: 500; margin: 0.25rem 0 0 0;">{{ job.salary }}</p>
        </div>
        {% endif %}
    </div>

    {% if job.match_reasoning %}
    <div style="margin-bottom: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
        <p style="color: #666; font-size: 0.875rem; margin: 0 0 0.5rem 0;">ğŸ’¡ Why it matches:</p>
        <p style="margin: 0; color: #333;">{{ job.match_reasoning[:200] }}{% if job.match_reasoning|length > 200 %}...{%
            endif %}</p>
    </div>
    {% endif %}

    {% if job.key_alignments %}
    <div style="margin-bottom: 1.5rem;">
        <p style="color: #666; font-size: 0.875rem; margin: 0 0 0.5rem 0;">âœ… Key Alignments:</p>
        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
            {% for alignment in job.key_alignments[:3] %}
            <span
                style="background: #d4edda; color: #155724; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.875rem;">
                {{ alignment }}
            </span>
            {% endfor %}
            {% if job.key_alignments|length > 3 %}
            <span
                style="background: #e2e3e5; color: #383d41; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.875rem;">
                +{{ job.key_alignments|length - 3 }} more
            </span>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Resume & Cover Letter Section -->
    <div style="margin-bottom: 1.5rem; padding: 1rem; background: #f0f8ff; border-radius: 8px; border: 1px solid #d0e8ff;">
        <p style="color: #666; font-size: 0.875rem; margin: 0 0 0.75rem 0; font-weight: 600;">ğŸ“„ Application Documents:</p>
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            {% if job.saved_resume %}
                <a href="{{ url_for('download_resume', resume_id=job.saved_resume.id) }}?format=pdf"
                   class="btn"
                   style="background: #28a745; display: inline-flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; padding: 0.5rem 1rem;">
                    <span>âœ…</span>
                    <span>View Resume</span>
                </a>
            {% else %}
                <a href="{{ url_for('job_detail', job_id=job.id) }}#generate-resume"
                   class="btn"
                   style="background: #6c757d; display: inline-flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; padding: 0.5rem 1rem;">
                    <span>â•</span>
                    <span>Generate Resume</span>
                </a>
            {% endif %}

            {% if job.saved_cover_letter_id %}
                <a href="{{ url_for('view_cover_letter', cover_letter_id=job.saved_cover_letter_id) }}"
                   class="btn"
                   style="background: #28a745; display: inline-flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; padding: 0.5rem 1rem;">
                    <span>âœ…</span>
                    <span>View Cover Letter</span>
                </a>
            {% else %}
                <a href="{{ url_for('generate_cover_letter_page', job_id=job.id) }}"
                   class="btn"
                   style="background: #6c757d; display: inline-flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; padding: 0.5rem 1rem;">
                    <span>â•</span>
                    <span>Generate Cover Letter</span>
                </a>
            {% endif %}
        </div>
    </div>

    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="{{ url_for('job_detail', job_id=job.id) }}" class="btn" style="flex: 1; min-width: 150px;">
            ğŸ“„ View Details
        </a>
        <a href="{{ job.url }}" target="_blank" class="btn" style="background: #007bff; flex: 1; min-width: 150px;">
            ğŸš€ Apply Now
        </a>
        <form method="POST" action="{{ url_for('remove_shortlist', job_id=job.id) }}" style="flex: 0;">
            <button type="submit" class="btn btn-secondary" onclick="return confirm('Remove from dashboard?')"
                title="Remove from dashboard">
                ğŸ—‘ï¸
            </button>
        </form>
    </div>

    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e0e0e0;">
        <form method="POST" action="{{ url_for('job_detail', job_id=job.id) }}#status-update"
            style="display: flex; gap: 0.5rem; align-items: center;">
            <label style="font-size: 0.875rem; color: #666;">Status:</label>
            <select name="status" onchange="this.form.submit()"
                style="padding: 0.5rem; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 0.875rem;">
                <option value="shortlisted" {% if job.status=='shortlisted' %}selected{% endif %}>ğŸ“‹ Planning to Apply
                </option>
                <option value="applying" {% if job.status=='applying' %}selected{% endif %}>âœï¸ Applying</option>
                <option value="applied" {% if job.status=='applied' %}selected{% endif %}>âœ… Applied</option>
                <option value="interviewing" {% if job.status=='interviewing' %}selected{% endif %}>ğŸ¯ Interviewing
                </option>
                <option value="offered" {% if job.status=='offered' %}selected{% endif %}>ğŸ‰ Offer Received</option>
                <option value="rejected" {% if job.status=='rejected' %}selected{% endif %}>âŒ Rejected</option>
            </select>
        </form>
    </div>
</div>
{% endfor %}

{% endif %}

<div class="card">
    <h3>ğŸ’¡ Tips for Successful Applications</h3>
    <ul style="margin-left: 1.5rem; margin-top: 1rem; line-height: 1.8;">
        <li>Review the job details thoroughly before applying</li>
        <li>Customize your cover letter for each position</li>
        <li>Highlight the key alignments in your application</li>
        <li>Address potential gaps proactively when relevant</li>
        <li>Keep your feedback updated to improve future recommendations</li>
    </ul>
</div>

{% endblock %}